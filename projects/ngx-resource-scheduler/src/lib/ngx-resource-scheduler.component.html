<div class="ngx-scheduler">

  <!-- Toolbar -->
  @if (showToolbar) {
    <div class="ngx-toolbar">
      <div class="ngx-toolbar-left">
        <button type="button" class="ngx-btn" (click)="navigatePrev()">{{ prevLabel }}</button>
        <button type="button" class="ngx-btn ngx-btn--ghost" (click)="navigateToday()">{{ todayLabel }}</button>
        <button type="button" class="ngx-btn" (click)="navigateNext()">{{ nextLabel }}</button>
      </div>
      <div class="ngx-toolbar-title">
        {{ rangeTitle }}
      </div>
      <div class="ngx-toolbar-right">
        @if (showDaysResourcesLabel) {
          <span class="ngx-toolbar-meta">
            {{ primaryAxis === 'days' ? (visibleDays.length + ' ' + daysLabel) : (resources.length + ' ' + resourcesLabel ) }}
          </span>
        }
        @if (!showDaysResourcesLabel) {
          <span class="ngx-toolbar-meta">&nbsp;</span>
        }
      </div>
    </div>
  }

  <!-- Header row -->
  <div class="ngx-header">
    <div class="ngx-time-gutter"></div>

    <div class="ngx-primary-headers" [style.gridTemplateColumns]="'repeat(' + primaryColumns.length + ', minmax(0, 1fr))'">
      @for (p of primaryColumns; track trackPrimary($index, p)) {
        <div class="ngx-primary-header">
          <div class="ngx-primary-title-row">
            <div class="ngx-primary-title">{{ p.title }}</div>
          </div>
          <div class="ngx-secondary-header-row" [style.gridTemplateColumns]="'repeat(' + secondaryColumns.length + ', minmax(0, 1fr))'">
            @for (s of secondaryColumns; track trackSecondary($index, s)) {
              <div class="ngx-secondary-header">
                <span class="ngx-secondary-header-title">{{ s.title }}</span>
              </div>
            }
          </div>
        </div>
      }
    </div>
  </div>

  <!-- Body -->
  <div class="ngx-body">
    <!-- time gutter -->
    <div class="ngx-time-gutter" [style.height.px]="timelineHeightPx">
      @for (h of hourLabels; track h) {
        <div
          class="ngx-hour-label"
          [style.top.px]="hourTopPx(h)">
          {{ formatHour(h) }}
        </div>
      }
    </div>


    <!-- grid -->
    <div class="ngx-grid"
      [style.gridTemplateColumns]="'repeat(' + primaryColumns.length + ', minmax(0, 1fr))'"
      [style.height.px]="timelineHeightPx">

      @for (p of primaryColumns; track trackPrimary($index, p)) {
        <div class="ngx-primary-col">
          <div class="ngx-secondary-cols"
            [style.gridTemplateColumns]="'repeat(' + secondaryColumns.length + ', minmax(0, 1fr))'"
            [style.height.px]="timelineHeightPx">
            <!-- Each cell is (day, resource) regardless of axis order -->
            @for (s of secondaryColumns; track trackSecondary($index, s)) {
              <div class="ngx-cell"
                #cellEl
                [style.height.px]="timelineHeightPx"
                (click)="cellClick(p, s, $event)"
                [attr.data-day]="cellDayKey(p,s)"
                [attr.data-resource]="cellResourceId(p,s)">
                <!-- grid lines -->
                <div class="ngx-lines" aria-hidden="true">
                  <!-- slot lines -->
                  @for (line of slotLines; track line) {
                    <div
                      class="ngx-line ngx-line--slot"
                      [style.top.px]="line.top"
                      [class.ngx-line--half]="line.isHalfHour"
                      [class.is-hidden]="slotLineStyle === 'hour'">
                    </div>
                  }
                  <!-- hour lines -->
                  @for (top of hourLineOffsetsPx; track top) {
                    <div
                      class="ngx-line ngx-line--hour"
                      [style.top.px]="top"
                      [class.is-hidden]="slotLineStyle === 'slot'">
                    </div>
                  }
                </div>
                <!-- events -->
                <!-- ngClass and 2nd ngStyle are only used when user passes custom class/style -->
                @for (e of cellEvents(p, s); track trackEvent($index, e)) {
                  <div class="ngx-event"
                    [ngStyle]="getEventLayoutStyle(e, p, s)"
                    (click)="onEventClick(e, $event); $event.stopPropagation()"
                    [ngClass]="eventClass ? eventClass(e) : null"
                    [attr.title]="eventTooltip(e)">
                    @if (eventTemplate) {
                      <ng-container
                        [ngTemplateOutlet]="eventTemplate"
                        [ngTemplateOutletContext]="eventTemplateCtx(e, p, s)">
                      </ng-container>
                    } @else {
                      <div class="ngx-event-title">{{ e.title }}</div>
                      <div class="ngx-event-time">
                        {{ toDisplayZone(e.start) | date:'HH:mm' }}â€“{{ toDisplayZone(e.end) | date:'HH:mm' }}
                      </div>
                    }
                  </div>
                }
              </div>
            }
          </div>
        </div>
      }

    </div>
  </div>

</div>
